FROM ubuntu:20.10

## for apt to be noninteractive
ENV DEBIAN_FRONTEND noninteractive
ENV DEBCONF_NONINTERACTIVE_SEEN true

RUN apt-get update && apt-get install -y build-essential cmake

WORKDIR /code

code:
  COPY src src
  SAVE IMAGE

build:
  FROM +code
  RUN cmake src
  RUN --mount=type=cache,target=/code/CMakeFiles make
  SAVE ARTIFACT hello-world AS LOCAL "hello-world"

docker:
  COPY +build/hello-world /bin/hello-world
  ENTRYPOINT ["/bin/hello-world"]
  SAVE IMAGE c-example:latest
